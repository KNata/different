-- MySQL Script generated by MySQL Workbench
-- Fri Dec 21 17:09:18 2018
-- Model: New Model    Version: 1.0
-- MySQL Workbench Forward Engineering

SET @OLD_UNIQUE_CHECKS=@@UNIQUE_CHECKS, UNIQUE_CHECKS=0;
SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0;
SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='TRADITIONAL,ALLOW_INVALID_DATES';

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
DROP SCHEMA IF EXISTS `mydb` ;

-- -----------------------------------------------------
-- Schema mydb
-- -----------------------------------------------------
CREATE SCHEMA IF NOT EXISTS `mydb` DEFAULT CHARACTER SET utf8 ;
USE `mydb` ;

-- -----------------------------------------------------
-- Table `mydb`.`Bus`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Bus` ;

CREATE TABLE IF NOT EXISTS `mydb`.`Bus` (
  `busID` VARCHAR(45) NOT NULL,
  `busModel` VARCHAR(45) NOT NULL,
  `maintance` TINYINT(4) NOT NULL,
  `maxPassengers` INT(11) NOT NULL,
  `miles` INT(11) NOT NULL,
  PRIMARY KEY (`busID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `mydb`.`Driver`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Driver` ;

CREATE TABLE IF NOT EXISTS `mydb`.`Driver` (
  `driverID` VARCHAR(45) NOT NULL,
  `driverName` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`driverID`))
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `mydb`.`Route`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Route` ;

CREATE TABLE IF NOT EXISTS `mydb`.`Route` (
  `routeID` INT(11) NOT NULL,
  `routeName` VARCHAR(45) NOT NULL,
  `driverID` VARCHAR(45) NULL DEFAULT NULL,
  `busID` VARCHAR(45) NULL DEFAULT NULL,
  `cityOfDeparture` VARCHAR(45) NOT NULL,
  `cityOfArrival` VARCHAR(45) NOT NULL,
  `routeDuration` INT(11) NULL DEFAULT NULL,
  `departureTime` DATE NOT NULL,
  `arrivalTime` DATE NOT NULL,
  PRIMARY KEY (`routeID`),
  INDEX `driverID_idx` (`driverID` ASC),
  INDEX `busID_idx` (`busID` ASC),
  CONSTRAINT `busID`
    FOREIGN KEY (`busID`)
    REFERENCES `mydb`.`Bus` (`busID`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `driverID`
    FOREIGN KEY (`driverID`)
    REFERENCES `mydb`.`Driver` (`driverID`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;

-- -----------------------------------------------------
-- Table `mydb`.`Stop`
-- -----------------------------------------------------

CREATE TABLE IF NOT EXISTS `mydb`.`Stop` (
  `stopID` VARCHAR(45) NOT NULL,
  `driverID` VARCHAR(45) NULL DEFAULT NULL,
  `busID` VARCHAR(45) NULL DEFAULT NULL,
  `stopName` VARCHAR(45) NOT NULL,
  `timeOfArrival` DATE NOT NULL,
  `timeOfDeparture` DATE NOT NULL,
  `stopDuration` INT(11) NULL DEFAULT NULL,
  PRIMARY KEY (`stopID`),
  INDEX `driverID_idx` (`driverID` ASC),
  INDEX `busID_idx` (`busID` ASC),
  CONSTRAINT `busID`
    FOREIGN KEY (`busID`)
    REFERENCES `mydb`.`Bus` (`busID`)
    ON DELETE CASCADE
    ON UPDATE CASCADE,
  CONSTRAINT `driverID`
    FOREIGN KEY (`driverID`)
    REFERENCES `mydb`.`Driver` (`driverID`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


-- -----------------------------------------------------
-- Table `mydb`.`Visitor`
-- -----------------------------------------------------
DROP TABLE IF EXISTS `mydb`.`Visitor` ;

CREATE TABLE IF NOT EXISTS `mydb`.`Visitor` (
  `visitorID` VARCHAR(45) NOT NULL,
  `login` VARCHAR(45) NOT NULL,
  `password` VARCHAR(45) NOT NULL,
  `visitorRole` VARCHAR(45) NOT NULL,
  `visitorName` VARCHAR(45) NOT NULL,
  `Driver_driverID` VARCHAR(45) NOT NULL,
  PRIMARY KEY (`visitorID`),
  INDEX `fk_Visitor_Driver1_idx` (`Driver_driverID` ASC),
  CONSTRAINT `fk_Visitor_Driver1`
    FOREIGN KEY (`Driver_driverID`)
    REFERENCES `mydb`.`Driver` (`driverID`)
    ON DELETE CASCADE
    ON UPDATE CASCADE)
ENGINE = InnoDB
DEFAULT CHARACTER SET = utf8;


SET SQL_MODE=@OLD_SQL_MODE;
SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS;
SET UNIQUE_CHECKS=@OLD_UNIQUE_CHECKS;

insert into `mydb`.`Bus` values("KI677", "Bogdan", true, 56, 8999);
insert into `mydb`.`Bus` values("EW6744", "Scania", true, 90, 3222);
insert into `mydb`.`Bus` values("УЕ4567", "Богдан", true, 40, 7888);
insert into `mydb`.`Bus` values("ДМ746", "Богдан", true, 56, 899);

insert into `mydb`.`Driver` values("RD676", "Bogdan Zatorsky");
insert into `mydb`.`Driver` values("EW56748", "Andriy Oleksiev");
insert into `mydb`.`Driver` values("ЛЕ2478", "Олексій Сукач");
insert into `mydb`.`Driver` values("ЕО746", "Владислав Онупрієнко");

insert into `mydb`.`Stop` values("KL12", "RD676", "EW6744", "Zhutomyr", "2018-11-11 14:00:00", "14:30:00", 0.30);
insert into `mydb`.`Stop` values("KL12", "RD676", "EW6744", "Rivne", "2018-11-11 17:30:00", "18:00:00", 0.30);
insert into `mydb`.`Stop` values("KL12", "RD676", "EW6744", "Brody", "2018-11-11 19:30:00", "19:45:00", 0.15);

insert into `mydb`.`Route` values(1, "Kyiv-Lviv", "RD676", "KI677", "Kyiv", "Lviv", 8, "2018-11-11 13:00:00", "2018-11-11 22:00:00");
insert into `mydb`.`Route` values(2, "Kyiv-Chernihiv", "ЕО746", "УЕ4567", "Kyiv", "Chernihiv", 2, "2018-11-13 10:00:00", "2018-11-11 12:30:00");
insert into `mydb`.`Route` values(3, "Kyiv-Kharkiv", "ЛЕ2478", "EW6744", "Kyiv", "Kharkiv", 8, "2018-11-11 13:00:00", "2018-11-11 20:00:00");
insert into `mydb`.`Route` values(4, "Kyiv-Odessa", "EW56748", "ДМ746", "Kyiv", "Odessa", 8, "2019-11-11 13:00:00", "2019-11-11 20:00:00");

insert into `mydb`.`Visitor`values(2, "bodia", "4321", "driver","Bogdan Zatorsky", "RD676");
insert into `mydb`.`Visitor`values(3, "oleksii", "4567", "driver","Олексій Сукач", "ЛЕ2478");

select * from `mydb`.`Bus`;
select * from `mydb`.`Driver`;
select * from `mydb`.`Route`;
select * from `mydb`.`Visitor`;

update `mydb`.`Route` set  cityOfArrival = "Kherson" where cityOfArrival = "Kharkiv";
select * from `mydb`.`Route` where `routeID` = 3;

